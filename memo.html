<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" sizes="32x32" href="./images/icon.png?v=2">
<title>???</title>

<!-- External Libraries -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  background: #0a0a0a;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
  background-attachment: fixed;
  color: #fff;
  min-height: 100vh;
}

header {
  background: rgba(0, 0, 0, 0.9);
  border-bottom: 2px solid rgba(103, 6, 118, 0.4);
  padding: 1.5rem 2rem;
  backdrop-filter: blur(10px);
  position: sticky;
  top: 0;
  z-index: 100;
}

nav {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.logo {
  font-size: 1.75rem;
  font-weight: bold;
  background: linear-gradient(135deg, #a855f7, #ec4899);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.header-actions {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.header-btn {
  background: rgba(103, 6, 118, 0.2);
  border: 1px solid rgba(103, 6, 118, 0.3);
  color: #a855f7;
  padding: 0.6rem 1.2rem;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  font-size: 0.9rem;
}

.header-btn:hover {
  background: rgba(103, 6, 118, 0.4);
  border-color: #670676;
  transform: translateY(-2px);
}

main {
  padding: 3rem 1.5rem;
}

.mode-switcher {
  max-width: 1200px;
  margin: 0 auto 2rem;
  display: flex;
  gap: 1rem;
  justify-content: center;
  flex-wrap: wrap;
}

.mode-btn {
  background: rgba(103, 6, 118, 0.2);
  border: 2px solid rgba(103, 6, 118, 0.3);
  border-radius: 12px;
  padding: 1rem 2rem;
  color: #9ca3af;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
}

.mode-btn:hover {
  border-color: #670676;
  transform: translateY(-2px);
}

.mode-btn.active {
  background: linear-gradient(135deg, #670676, #8800aa);
  border-color: #670676;
  color: #fff;
  box-shadow: 0 8px 20px rgba(103, 6, 118, 0.4);
}

.content-area {
  max-width: 1200px;
  margin: 0 auto;
}

.todo-container, .memo-container {
  background: linear-gradient(135deg, rgba(17, 17, 17, 0.95), rgba(0, 0, 0, 0.95));
  border: 2px solid rgba(103, 6, 118, 0.3);
  border-radius: 16px;
  padding: 2.5rem;
  display: none;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

.todo-container.active, .memo-container.active {
  display: block;
  animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

h1 {
  font-size: 2.5rem;
  margin-bottom: 2rem;
  text-align: center;
  background: linear-gradient(135deg, #a855f7, #ec4899);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.input-section {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 2rem;
  flex-wrap: wrap;
}

#todoInput, #memoTitle, #memoContent, #memoTags {
  width: 100%;
  background: rgba(103, 6, 118, 0.1);
  border: 2px solid rgba(103, 6, 118, 0.3);
  border-radius: 8px;
  padding: 0.875rem 1.25rem;
  color: #fff;
  font-size: 1rem;
  transition: all 0.3s;
}

#memoContent {
  min-height: 200px;
  resize: vertical;
  font-family: 'Monaco', 'Courier New', monospace;
  line-height: 1.6;
}

input:focus, textarea:focus {
  outline: none;
  border-color: #670676;
  box-shadow: 0 0 20px rgba(103, 6, 118, 0.3);
}

input::placeholder, textarea::placeholder {
  color: #6b7280;
}

.btn-primary {
  background: linear-gradient(135deg, #670676, #8800aa);
  border: none;
  border-radius: 8px;
  padding: 0.875rem 2rem;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 15px rgba(103, 6, 118, 0.3);
}

.btn-primary:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(103, 6, 118, 0.5);
}

.btn-success {
  background: linear-gradient(135deg, #10b981, #059669);
  border: none;
  border-radius: 8px;
  padding: 0.875rem 2rem;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-success:hover {
  transform: scale(1.05);
}

.filter-tabs, .memo-filters {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
}

.filter-btn {
  background: transparent;
  border: 1px solid rgba(103, 6, 118, 0.3);
  color: #9ca3af;
  padding: 0.5rem 1rem;
  cursor: pointer;
  font-weight: 600;
  border-radius: 6px;
  transition: all 0.3s;
}

.filter-btn:hover {
  border-color: #670676;
}

.filter-btn.active {
  background: rgba(103, 6, 118, 0.3);
  color: #a855f7;
  border-color: #670676;
}

.todo-list {
  list-style: none;
  max-height: 500px;
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: #670676 rgba(103, 6, 118, 0.2);
}

.todo-list::-webkit-scrollbar {
  width: 8px;
}

.todo-list::-webkit-scrollbar-track {
  background: rgba(103, 6, 118, 0.2);
  border-radius: 10px;
}

.todo-list::-webkit-scrollbar-thumb {
  background: #670676;
  border-radius: 10px;
}

.todo-item {
  background: rgba(103, 6, 118, 0.1);
  border: 1px solid rgba(103, 6, 118, 0.2);
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 0.75rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  transition: all 0.3s;
}

.todo-item:hover {
  border-color: #670676;
  transform: translateX(4px);
}

.todo-main-row {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.checkbox {
  width: 24px;
  height: 24px;
  min-width: 24px;
  border: 2px solid #670676;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.checkbox:hover {
  background: rgba(103, 6, 118, 0.2);
}

.checkbox.checked {
  background: #670676;
}

.checkbox.checked::after {
  content: 'âœ“';
  color: #fff;
  font-weight: bold;
}

.todo-text {
  flex: 1;
  font-size: 1rem;
  word-break: break-word;
}

.todo-item.completed .todo-text {
  text-decoration: line-through;
  color: #6b7280;
}

.todo-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.priority-badge {
  padding: 0.25rem 0.6rem;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: bold;
  white-space: nowrap;
}

.priority-high {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.priority-medium {
  background: rgba(251, 191, 36, 0.2);
  color: #fbbf24;
  border: 1px solid rgba(251, 191, 36, 0.3);
}

.priority-low {
  background: rgba(16, 185, 129, 0.2);
  color: #10b981;
  border: 1px solid rgba(16, 185, 129, 0.3);
}

.due-date-badge {
  padding: 0.25rem 0.6rem;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: bold;
  background: rgba(59, 130, 246, 0.2);
  color: #3b82f6;
  border: 1px solid rgba(59, 130, 246, 0.3);
  white-space: nowrap;
}

.due-date-badge.overdue {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
  border-color: rgba(239, 68, 68, 0.3);
}

.todo-meta {
  display: flex;
  gap: 1rem;
  font-size: 0.8rem;
  color: #9ca3af;
  padding-left: 2.5rem;
  flex-wrap: wrap;
}

.todo-tag {
  background: rgba(103, 6, 118, 0.2);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  border: 1px solid rgba(103, 6, 118, 0.3);
}

.action-btn {
  background: rgba(220, 38, 38, 0.2);
  border: 1px solid rgba(220, 38, 38, 0.3);
  border-radius: 6px;
  padding: 0.4rem 0.7rem;
  color: #ef4444;
  cursor: pointer;
  font-size: 0.75rem;
  transition: all 0.3s;
  white-space: nowrap;
}

.action-btn:hover {
  background: rgba(220, 38, 38, 0.3);
  transform: scale(1.05);
}

.action-btn.export {
  background: rgba(16, 185, 129, 0.2);
  border-color: rgba(16, 185, 129, 0.3);
  color: #10b981;
}

.action-btn.export:hover {
  background: rgba(16, 185, 129, 0.3);
}

.action-btn.edit {
  background: rgba(59, 130, 246, 0.2);
  border-color: rgba(59, 130, 246, 0.3);
  color: #3b82f6;
}

.action-btn.edit:hover {
  background: rgba(59, 130, 246, 0.3);
}

.action-btn.duplicate {
  background: rgba(168, 85, 247, 0.2);
  border-color: rgba(168, 85, 247, 0.3);
  color: #a855f7;
}

.action-btn.duplicate:hover {
  background: rgba(168, 85, 247, 0.3);
}

.export-section {
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(103, 6, 118, 0.3);
  display: flex;
  gap: 1rem;
  justify-content: center;
  flex-wrap: wrap;
}

.stats {
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(103, 6, 118, 0.3);
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1.5rem;
  text-align: center;
}

.stat-item {
  background: rgba(103, 6, 118, 0.1);
  border: 1px solid rgba(103, 6, 118, 0.2);
  border-radius: 12px;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  transition: all 0.3s;
}

.stat-item:hover {
  border-color: #670676;
  transform: translateY(-4px);
}

.stat-value {
  font-size: 2rem;
  font-weight: bold;
  background: linear-gradient(135deg, #a855f7, #ec4899);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.stat-label {
  font-size: 0.875rem;
  color: #9ca3af;
}

.memo-toolbar {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
  flex-wrap: wrap;
}

.toolbar-btn {
  background: rgba(103, 6, 118, 0.2);
  border: 1px solid rgba(103, 6, 118, 0.3);
  color: #a855f7;
  padding: 0.5rem 0.75rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  font-size: 0.85rem;
  white-space: nowrap;
}

.toolbar-btn:hover {
  background: rgba(103, 6, 118, 0.4);
  border-color: #670676;
  transform: translateY(-2px);
}

.memo-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1rem;
  max-height: 600px;
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: #670676 rgba(103, 6, 118, 0.2);
}

.memo-list::-webkit-scrollbar {
  width: 8px;
}

.memo-list::-webkit-scrollbar-track {
  background: rgba(103, 6, 118, 0.2);
  border-radius: 10px;
}

.memo-list::-webkit-scrollbar-thumb {
  background: #670676;
  border-radius: 10px;
}

.memo-item {
  background: rgba(103, 6, 118, 0.15);
  border: 1px solid rgba(103, 6, 118, 0.3);
  border-radius: 12px;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  transition: all 0.3s;
}

.memo-item:hover {
  border-color: #670676;
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(103, 6, 118, 0.3);
}

.memo-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 1rem;
}

.memo-title {
  font-size: 1.25rem;
  font-weight: bold;
  color: #a855f7;
  flex: 1;
  word-break: break-word;
}

.memo-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.memo-content {
  color: #d1d5db;
  line-height: 1.6;
  white-space: pre-wrap;
  word-break: break-word;
}

.memo-preview {
  background: rgba(103, 6, 118, 0.05);
  border: 2px solid rgba(103, 6, 118, 0.3);
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1rem;
  min-height: 200px;
  max-height: 400px;
  overflow-y: auto;
  display: none;
}

.memo-preview.active {
  display: block;
}

.memo-preview h1, .memo-preview h2, .memo-preview h3 {
  color: #a855f7;
  margin-top: 1rem;
  margin-bottom: 0.5rem;
}

.memo-preview h1 { font-size: 2rem; }
.memo-preview h2 { font-size: 1.5rem; }
.memo-preview h3 { font-size: 1.25rem; }

.memo-preview p {
  margin-bottom: 1rem;
}

.memo-preview code {
  background: rgba(103, 6, 118, 0.3);
  padding: 0.2rem 0.4rem;
  border-radius: 4px;
  color: #ec4899;
  font-family: 'Courier New', monospace;
}

.memo-preview pre {
  background: rgba(0, 0, 0, 0.5);
  padding: 1rem;
  border-radius: 8px;
  overflow-x: auto;
  border: 1px solid rgba(103, 6, 118, 0.3);
  margin: 1rem 0;
}

.memo-preview pre code {
  background: none;
  padding: 0;
  color: #a855f7;
}

.memo-preview blockquote {
  border-left: 4px solid #670676;
  padding-left: 1rem;
  margin: 1rem 0;
  color: #9ca3af;
  font-style: italic;
}

.memo-preview ul, .memo-preview ol {
  margin-left: 1.5rem;
  margin-bottom: 1rem;
}

.memo-preview li {
  margin-bottom: 0.5rem;
}

.memo-preview table {
  width: 100%;
  border-collapse: collapse;
  margin: 1rem 0;
}

.memo-preview table th, .memo-preview table td {
  border: 1px solid rgba(103, 6, 118, 0.3);
  padding: 0.75rem;
  text-align: left;
}

.memo-preview table th {
  background: rgba(103, 6, 118, 0.2);
  color: #a855f7;
  font-weight: bold;
}

.memo-preview img {
  max-width: 100%;
  border-radius: 8px;
  margin: 1rem 0;
}

.memo-preview a {
  color: #3b82f6;
  text-decoration: underline;
}

.memo-preview a:hover {
  color: #60a5fa;
}

.memo-preview hr {
  border: none;
  border-top: 2px solid rgba(103, 6, 118, 0.3);
  margin: 1.5rem 0;
}

.view-toggle {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.view-btn {
  background: rgba(103, 6, 118, 0.2);
  border: 1px solid rgba(103, 6, 118, 0.3);
  color: #a855f7;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  font-size: 0.9rem;
}

.view-btn:hover {
  background: rgba(103, 6, 118, 0.4);
  border-color: #670676;
}

.view-btn.active {
  background: rgba(103, 6, 118, 0.4);
  border-color: #670676;
  box-shadow: 0 4px 10px rgba(103, 6, 118, 0.3);
}

.chart-container {
  background: rgba(103, 6, 118, 0.1);
  border: 1px solid rgba(103, 6, 118, 0.2);
  border-radius: 12px;
  padding: 1.5rem;
  margin: 1rem 0;
}

.memo-tags-display {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.memo-tag-item {
  background: rgba(103, 6, 118, 0.3);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  color: #a855f7;
  border: 1px solid rgba(103, 6, 118, 0.4);
}

.memo-date {
  font-size: 0.75rem;
  color: #6b7280;
  text-align: right;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  padding: 2rem;
  backdrop-filter: blur(5px);
}

.modal.active {
  display: flex;
  animation: fadeIn 0.3s ease-in-out;
}

.modal-content {
  background: linear-gradient(135deg, rgba(17, 17, 17, 0.98), rgba(0, 0, 0, 0.98));
  border: 2px solid #670676;
  border-radius: 16px;
  padding: 2rem;
  max-width: 600px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
  box-shadow: 0 20px 60px rgba(103, 6, 118, 0.5);
}

.modal-title {
  font-size: 1.5rem;
  margin-bottom: 1.5rem;
  color: #a855f7;
}

.modal-input, .modal-select, .modal-textarea {
  width: 100%;
  background: rgba(103, 6, 118, 0.1);
  border: 2px solid rgba(103, 6, 118, 0.3);
  border-radius: 8px;
  padding: 0.875rem;
  color: #fff;
  margin-bottom: 1rem;
  transition: all 0.3s;
}

.modal-textarea {
  min-height: 100px;
  resize: vertical;
  font-family: inherit;
}

.modal-input:focus, .modal-select:focus, .modal-textarea:focus {
  outline: none;
  border-color: #670676;
  box-shadow: 0 0 20px rgba(103, 6, 118, 0.3);
}

.modal-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  flex-wrap: wrap;
}

.modal-btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
}

.modal-btn-primary {
  background: linear-gradient(135deg, #670676, #8800aa);
  color: #fff;
}

.modal-btn-primary:hover {
  transform: scale(1.05);
}

.modal-btn-secondary {
  background: rgba(103, 6, 118, 0.2);
  color: #a855f7;
  border: 1px solid rgba(103, 6, 118, 0.3);
}

.modal-btn-secondary:hover {
  background: rgba(103, 6, 118, 0.4);
}

.close-modal {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: rgba(220, 38, 38, 0.2);
  border: none;
  color: #ef4444;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s;
}

.close-modal:hover {
  background: rgba(220, 38, 38, 0.4);
}

.shortcuts-list {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.shortcut-section h3 {
  color: #a855f7;
  font-size: 1.1rem;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid rgba(103, 6, 118, 0.3);
}

.shortcut-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  background: rgba(103, 6, 118, 0.1);
  border-radius: 8px;
  margin-bottom: 0.5rem;
}

.shortcut-item kbd {
  background: rgba(103, 6, 118, 0.3);
  border: 1px solid rgba(103, 6, 118, 0.5);
  border-radius: 4px;
  padding: 0.25rem 0.5rem;
  font-family: 'Courier New', monospace;
  font-size: 0.85rem;
  color: #a855f7;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.shortcut-item span {
  color: #d1d5db;
}

.search-results {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-top: 1rem;
}

.search-result-item {
  background: rgba(103, 6, 118, 0.1);
  border: 1px solid rgba(103, 6, 118, 0.3);
  border-radius: 8px;
  padding: 1rem;
  cursor: pointer;
  transition: all 0.3s;
}

.search-result-item:hover {
  border-color: #670676;
  transform: translateX(4px);
}

.search-result-title {
  font-weight: bold;
  color: #a855f7;
  margin-bottom: 0.5rem;
}

.search-result-preview {
  color: #9ca3af;
  font-size: 0.9rem;
}

.sort-controls {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
  align-items: center;
}

.sort-label {
  color: #9ca3af;
  font-size: 0.9rem;
  font-weight: 600;
}

.sort-select {
  background: rgba(103, 6, 118, 0.2);
  border: 1px solid rgba(103, 6, 118, 0.3);
  color: #a855f7;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
}

.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  color: #6b7280;
}

.empty-state-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.empty-state-text {
  font-size: 1.2rem;
}

@media (max-width: 768px) {
  .mode-switcher, .input-section, .export-section {
    flex-direction: column;
  }
  
  .memo-list {
    grid-template-columns: 1fr;
  }
  
  .stats {
    grid-template-columns: 1fr;
  }
  
  h1 {
    font-size: 2rem;
  }
  
  .todo-main-row {
    flex-wrap: wrap;
  }
  
  .todo-actions {
    width: 100%;
    padding-left: 2.5rem;
  }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.todo-item, .memo-item {
  animation: slideIn 0.3s ease-out;
}

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: rgba(103, 6, 118, 0.1);
}

::-webkit-scrollbar-thumb {
  background: #670676;
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: #8800aa;
}
</style>
</head>
<body>
<header>
  <nav>
    <div class="logo">ğŸ“ Todo & Memo Pro</div>
    <div class="header-actions">
      <button class="header-btn" onclick="openSearch()">ğŸ” æ¤œç´¢</button>
      <button class="header-btn" onclick="showStats()">ğŸ“Š çµ±è¨ˆ</button>
      <button class="header-btn" onclick="showKeyboardShortcuts()">âŒ¨ï¸ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</button>
      <button class="header-btn" onclick="openSettings()">âš™ï¸ è¨­å®š</button>
      <button class="header-btn" id="langSwitcher">EN</button>
    </div>
  </nav>
</header>

<main>
  <div class="mode-switcher">
    <button class="mode-btn active" data-mode="todo">ğŸ“ Todoãƒªã‚¹ãƒˆ</button>
    <button class="mode-btn" data-mode="memo">ğŸ“„ ãƒ¡ãƒ¢</button>
  </div>

  <div class="content-area">
    <!-- Todo Container -->
    <div class="todo-container active">
      <h1>ã‚¿ã‚¹ã‚¯ç®¡ç†</h1>
      
      <div class="input-section">
        <input type="text" id="todoInput" placeholder="ä½•ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ">
        <button class="btn-primary" id="addTodoBtn">ã‚¿ã‚¹ã‚¯è¿½åŠ </button>
      </div>

      <div class="sort-controls">
        <span class="sort-label">ä¸¦ã³æ›¿ãˆ:</span>
        <select class="sort-select" id="todoSort">
          <option value="newest">æ–°ã—ã„é †</option>
          <option value="oldest">å¤ã„é †</option>
          <option value="priority">å„ªå…ˆåº¦é †</option>
          <option value="duedate">æœŸé™é †</option>
          <option value="alphabetical">ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †</option>
        </select>
      </div>

      <div class="filter-tabs">
        <button class="filter-btn active" data-filter="all">ã™ã¹ã¦</button>
        <button class="filter-btn" data-filter="active">æœªå®Œäº†</button>
        <button class="filter-btn" data-filter="completed">å®Œäº†æ¸ˆã¿</button>
        <button class="filter-btn" data-filter="high">å„ªå…ˆåº¦: é«˜</button>
        <button class="filter-btn" data-filter="medium">å„ªå…ˆåº¦: ä¸­</button>
        <button class="filter-btn" data-filter="low">å„ªå…ˆåº¦: ä½</button>
        <button class="filter-btn" data-filter="overdue">æœŸé™åˆ‡ã‚Œ</button>
      </div>

      <ul class="todo-list" id="todoList"></ul>

      <div class="stats">
        <div class="stat-item">
          <div class="stat-value" id="totalTasks">0</div>
          <div class="stat-label">åˆè¨ˆ</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="activeTasks">0</div>
          <div class="stat-label">æœªå®Œäº†</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="completedTasks">0</div>
          <div class="stat-label">å®Œäº†æ¸ˆã¿</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="completionRate">0%</div>
          <div class="stat-label">é”æˆç‡</div>
        </div>
      </div>

      <div class="export-section">
        <button class="btn-success" onclick="exportAllTodos()">ğŸ“¥ ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <button class="btn-primary" onclick="clearCompleted()">ğŸ—‘ï¸ å®Œäº†æ¸ˆã¿ã‚’å‰Šé™¤</button>
      </div>
    </div>

    <!-- Memo Container -->
    <div class="memo-container">
      <h1>ãƒ¡ãƒ¢ç®¡ç†</h1>
      
      <div class="memo-input-section">
        <input type="text" id="memoTitle" placeholder="ãƒ¡ãƒ¢ã‚¿ã‚¤ãƒˆãƒ«...">
        
        <div class="view-toggle">
          <button class="view-btn active" id="editViewBtn" onclick="switchMemoView('edit')">âœï¸ ç·¨é›†</button>
          <button class="view-btn" id="previewViewBtn" onclick="switchMemoView('preview')">ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
        </div>
        
        <div class="memo-toolbar">
          <button class="toolbar-btn" onclick="insertText('**å¤ªå­—**')" title="å¤ªå­— (é¸æŠç¯„å›²ã‚’å¤ªå­—ã«)">
            <strong>B</strong>
          </button>
          <button class="toolbar-btn" onclick="insertText('*æ–œä½“*')" title="æ–œä½“ (é¸æŠç¯„å›²ã‚’æ–œä½“ã«)">
            <em>I</em>
          </button>
          <button class="toolbar-btn" onclick="insertText('~~æ‰“ã¡æ¶ˆã—ç·š~~')" title="æ‰“ã¡æ¶ˆã—ç·š">
            <s>S</s>
          </button>
          <button class="toolbar-btn" onclick="insertText('# ')" title="è¦‹å‡ºã—1">H1</button>
          <button class="toolbar-btn" onclick="insertText('## ')" title="è¦‹å‡ºã—2">H2</button>
          <button class="toolbar-btn" onclick="insertText('### ')" title="è¦‹å‡ºã—3">H3</button>
          <button class="toolbar-btn" onclick="insertText('- ')" title="ç®‡æ¡æ›¸ã">â€¢ List</button>
          <button class="toolbar-btn" onclick="insertText('1. ')" title="ç•ªå·ä»˜ããƒªã‚¹ãƒˆ">1. List</button>
          <button class="toolbar-btn" onclick="insertText('[ ] ')" title="ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹">â˜ Task</button>
          <button class="toolbar-btn" onclick="insertText('```\n\n```')" title="ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯">&lt;/&gt; Code</button>
          <button class="toolbar-btn" onclick="insertText('> ')" title="å¼•ç”¨">â Quote</button>
          <button class="toolbar-btn" onclick="insertLink()" title="ãƒªãƒ³ã‚¯">ğŸ”— Link</button>
          <button class="toolbar-btn" onclick="insertImage()" title="ç”»åƒ">ğŸ–¼ï¸ Image</button>
          <button class="toolbar-btn" onclick="insertTable()" title="ãƒ†ãƒ¼ãƒ–ãƒ«">ğŸ“Š Table</button>
          <button class="toolbar-btn" onclick="insertHorizontalRule()" title="æ°´å¹³ç·š">â”€ HR</button>
        </div>
        
        <textarea id="memoContent" placeholder="ãƒ¡ãƒ¢ã‚’ã“ã“ã«æ›¸ã„ã¦ãã ã•ã„...&#10;&#10;Markdownã‚’ã‚µãƒãƒ¼ãƒˆ:&#10;**å¤ªå­—** *æ–œä½“* ~~æ‰“ã¡æ¶ˆã—ç·š~~&#10;# è¦‹å‡ºã—1 ## è¦‹å‡ºã—2 ### è¦‹å‡ºã—3&#10;- ãƒªã‚¹ãƒˆ 1. ç•ªå·ä»˜ããƒªã‚¹ãƒˆ [ ] ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹&#10;> å¼•ç”¨ ``` ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ ``` [ãƒªãƒ³ã‚¯](URL)"></textarea>
        
        <div id="memoPreview" class="memo-preview"></div>
        
        <input type="text" id="memoTags" placeholder="ã‚¿ã‚° (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š: ä»•äº‹, ã‚¢ã‚¤ãƒ‡ã‚¢, é‡è¦)">
        
        <button class="btn-primary" id="addMemoBtn">ãƒ¡ãƒ¢ã‚’ä¿å­˜</button>
      </div>

      <div class="sort-controls">
        <span class="sort-label">ä¸¦ã³æ›¿ãˆ:</span>
        <select class="sort-select" id="memoSort">
          <option value="newest">æ–°ã—ã„é †</option>
          <option value="oldest">å¤ã„é †</option>
          <option value="alphabetical">ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †</option>
          <option value="longest">é•·ã„é †</option>
        </select>
      </div>

      <div class="memo-filters" id="memoFilters">
        <button class="filter-btn active" onclick="filterMemosByTag('all')">ã™ã¹ã¦</button>
      </div>

      <div class="export-section">
        <button class="btn-success" onclick="exportAllMemos()">ğŸ“¥ ã™ã¹ã¦ã®ãƒ¡ãƒ¢ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      </div>

      <div class="memo-list" id="memoList"></div>
    </div>
  </div>
</main>

<!-- Search Modal -->
<div class="modal" id="searchModal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeSearch()">âœ•</button>
    <h2 class="modal-title">ğŸ” æ¤œç´¢</h2>
    <input type="text" class="modal-input" id="searchInput" placeholder="ã‚¿ã‚¹ã‚¯ã‚„ãƒ¡ãƒ¢ã‚’æ¤œç´¢...">
    <div class="search-results" id="searchResults"></div>
  </div>
</div>

<!-- Edit Todo Modal -->
<div class="modal" id="editTodoModal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeEditTodoModal()">âœ•</button>
    <h2 class="modal-title">ğŸ“ ã‚¿ã‚¹ã‚¯ã‚’ç·¨é›†</h2>
    <input type="text" class="modal-input" id="editTodoText" placeholder="ã‚¿ã‚¹ã‚¯ã®å†…å®¹">
    <select class="modal-select" id="editTodoPriority">
      <option value="">å„ªå…ˆåº¦ãªã—</option>
      <option value="high">é«˜</option>
      <option value="medium">ä¸­</option>
      <option value="low">ä½</option>
    </select>
    <input type="date" class="modal-input" id="editTodoDueDate" placeholder="æœŸé™">
    <input type="text" class="modal-input" id="editTodoTags" placeholder="ã‚¿ã‚° (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)">
    <textarea class="modal-textarea" id="editTodoNote" placeholder="ãƒ¡ãƒ¢"></textarea>
    <div class="modal-actions">
      <button class="modal-btn modal-btn-secondary" onclick="closeEditTodoModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="modal-btn modal-btn-primary" onclick="saveEditedTodo()">ä¿å­˜</button>
    </div>
  </div>
</div>

<!-- Stats Modal -->
<div class="modal" id="statsModal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeStats()">âœ•</button>
    <h2 class="modal-title">ğŸ“Š çµ±è¨ˆæƒ…å ±</h2>
    <div id="statsContent"></div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal" id="settingsModal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeSettings()">âœ•</button>
    <h2 class="modal-title">âš™ï¸ è¨­å®š</h2>
    <div class="modal-actions">
      <button class="modal-btn modal-btn-secondary" onclick="importData()">ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
      <button class="modal-btn modal-btn-primary" onclick="exportAllData()">ğŸ“¥ ã™ã¹ã¦ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      <button class="modal-btn modal-btn-secondary" onclick="clearAllData()">ğŸ—‘ï¸ ã™ã¹ã¦ã‚’å‰Šé™¤</button>
    </div>
  </div>
</div>

<!-- Keyboard Shortcuts Modal -->
<div class="modal" id="shortcutsModal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeKeyboardShortcuts()">âœ•</button>
    <h2 class="modal-title">âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</h2>
    <div class="shortcuts-list">
      <div class="shortcut-section">
        <h3>å…¨èˆ¬</h3>
        <div class="shortcut-item">
          <kbd>Ctrl/Cmd + K</kbd>
          <span>æ¤œç´¢ã‚’é–‹ã</span>
        </div>
        <div class="shortcut-item">
          <kbd>Esc</kbd>
          <span>ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹</span>
        </div>
      </div>
      
      <div class="shortcut-section">
        <h3>ãƒ¡ãƒ¢ç·¨é›†</h3>
        <div class="shortcut-item">
          <kbd>Ctrl/Cmd + B</kbd>
          <span>å¤ªå­—</span>
        </div>
        <div class="shortcut-item">
          <kbd>Ctrl/Cmd + I</kbd>
          <span>æ–œä½“</span>
        </div>
        <div class="shortcut-item">
          <kbd>Ctrl/Cmd + K</kbd>
          <span>ãƒªãƒ³ã‚¯æŒ¿å…¥</span>
        </div>
        <div class="shortcut-item">
          <kbd>Ctrl/Cmd + Shift + K</kbd>
          <span>ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯</span>
        </div>
        <div class="shortcut-item">
          <kbd>Ctrl/Cmd + Enter</kbd>
          <span>ãƒ¡ãƒ¢ã‚’ä¿å­˜</span>
        </div>
      </div>
      
      <div class="shortcut-section">
        <h3>Todo</h3>
        <div class="shortcut-item">
          <kbd>Enter</kbd>
          <span>ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ãƒ‡ãƒ¼ã‚¿ç®¡ç†
let todos = [];
let memos = [];
let currentFilter = 'all';
let currentMemoFilter = 'all';
let editingTodoId = null;
let currentLang = 'ja';
let allMemoTags = new Set();
let currentTodoSort = 'newest';
let currentMemoSort = 'newest';
let currentMemoView = 'edit';
let todoSortable = null;

// Marked.jsã®è¨­å®š
if (typeof marked !== 'undefined') {
  marked.setOptions({
    breaks: true,
    gfm: true
  });
}

// ãƒ¡ãƒ¢ãƒ“ãƒ¥ãƒ¼ã®åˆ‡ã‚Šæ›¿ãˆ
function switchMemoView(view) {
  currentMemoView = view;
  const textarea = document.getElementById('memoContent');
  const preview = document.getElementById('memoPreview');
  const editBtn = document.getElementById('editViewBtn');
  const previewBtn = document.getElementById('previewViewBtn');
  
  if (view === 'edit') {
    textarea.style.display = 'block';
    preview.classList.remove('active');
    editBtn.classList.add('active');
    previewBtn.classList.remove('active');
  } else {
    textarea.style.display = 'none';
    preview.classList.add('active');
    editBtn.classList.remove('active');
    previewBtn.classList.add('active');
    updateMemoPreview();
  }
}

// ãƒ¡ãƒ¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ›´æ–°
function updateMemoPreview() {
  const content = document.getElementById('memoContent').value;
  const preview = document.getElementById('memoPreview');
  
  if (typeof marked !== 'undefined') {
    preview.innerHTML = marked.parse(content || '*ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“*');
  } else {
    preview.innerHTML = content.replace(/\n/g, '<br>');
  }
}

// ãƒ¡ãƒ¢å…¥åŠ›æ™‚ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
document.addEventListener('DOMContentLoaded', function() {
  const memoContent = document.getElementById('memoContent');
  if (memoContent) {
    memoContent.addEventListener('input', function() {
      if (currentMemoView === 'preview') {
        updateMemoPreview();
      }
    });
  }
});

// ç¿»è¨³
const translations = {
  ja: {
    app_title: 'Todo & Memo Pro',
    search: 'æ¤œç´¢',
    stats: 'çµ±è¨ˆ',
    settings: 'è¨­å®š',
    todo_mode: 'Todoãƒªã‚¹ãƒˆ',
    memo_mode: 'ãƒ¡ãƒ¢',
    task_management: 'ã‚¿ã‚¹ã‚¯ç®¡ç†',
    memo_management: 'ãƒ¡ãƒ¢ç®¡ç†',
    add_task: 'ã‚¿ã‚¹ã‚¯è¿½åŠ ',
    add_memo: 'ãƒ¡ãƒ¢ã‚’ä¿å­˜',
    task_placeholder: 'ä½•ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
    memo_title_placeholder: 'ãƒ¡ãƒ¢ã‚¿ã‚¤ãƒˆãƒ«...',
    memo_content_placeholder: 'ãƒ¡ãƒ¢ã‚’ã“ã“ã«æ›¸ã„ã¦ãã ã•ã„...',
    tags_placeholder: 'ã‚¿ã‚° (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š: ä»•äº‹, ã‚¢ã‚¤ãƒ‡ã‚¢, é‡è¦)',
    sort_by: 'ä¸¦ã³æ›¿ãˆ:',
    sort_newest: 'æ–°ã—ã„é †',
    sort_oldest: 'å¤ã„é †',
    sort_priority: 'å„ªå…ˆåº¦é †',
    sort_duedate: 'æœŸé™é †',
    sort_alphabetical: 'ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †',
    sort_longest: 'é•·ã„é †',
    filter_all: 'ã™ã¹ã¦',
    filter_active: 'æœªå®Œäº†',
    filter_completed: 'å®Œäº†æ¸ˆã¿',
    filter_high: 'å„ªå…ˆåº¦: é«˜',
    filter_medium: 'å„ªå…ˆåº¦: ä¸­',
    filter_low: 'å„ªå…ˆåº¦: ä½',
    filter_overdue: 'æœŸé™åˆ‡ã‚Œ',
    stat_total: 'åˆè¨ˆ',
    stat_active: 'æœªå®Œäº†',
    stat_completed: 'å®Œäº†æ¸ˆã¿',
    stat_completion_rate: 'é”æˆç‡',
    export_all_tasks: 'ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',
    export_all_memos: 'ã™ã¹ã¦ã®ãƒ¡ãƒ¢ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',
    clear_completed: 'å®Œäº†æ¸ˆã¿ã‚’å‰Šé™¤',
    no_tasks: 'ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
    no_memos: 'ã¾ã ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“',
    delete_btn: 'å‰Šé™¤',
    export_btn: 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',
    edit_btn: 'ç·¨é›†',
    duplicate_btn: 'è¤‡è£½',
    priority_high: 'é«˜',
    priority_medium: 'ä¸­',
    priority_low: 'ä½',
    priority_none: 'å„ªå…ˆåº¦ãªã—',
    untitled: 'ç„¡é¡Œ',
    due_today: 'ä»Šæ—¥',
    due_tomorrow: 'æ˜æ—¥',
    overdue: 'æœŸé™åˆ‡ã‚Œ',
    completed: 'å®Œäº†',
    active: 'æœªå®Œäº†',
    edit_task: 'ã‚¿ã‚¹ã‚¯ã‚’ç·¨é›†',
    task_content: 'ã‚¿ã‚¹ã‚¯ã®å†…å®¹',
    due_date: 'æœŸé™',
    note: 'ãƒ¡ãƒ¢',
    cancel: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
    save: 'ä¿å­˜',
    stats_title: 'çµ±è¨ˆæƒ…å ±',
    total_tasks: 'ç·ã‚¿ã‚¹ã‚¯æ•°',
    active_tasks: 'æœªå®Œäº†ã‚¿ã‚¹ã‚¯',
    completed_tasks: 'å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯',
    high_priority_tasks: 'é«˜å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯',
    total_memos: 'ç·ãƒ¡ãƒ¢æ•°',
    tags_in_use: 'ä½¿ç”¨ä¸­ã®ã‚¿ã‚°',
    settings_title: 'è¨­å®š',
    import_data: 'ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ',
    export_data: 'ã™ã¹ã¦ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',
    clear_all: 'ã™ã¹ã¦ã‚’å‰Šé™¤',
    search_title: 'æ¤œç´¢',
    search_placeholder: 'ã‚¿ã‚¹ã‚¯ã‚„ãƒ¡ãƒ¢ã‚’æ¤œç´¢...',
    no_results: 'æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
    confirm_delete_task: 'ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹?',
    confirm_delete_memo: 'ã“ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹?',
    confirm_clear_completed: 'å®Œäº†æ¸ˆã¿ã®ã‚¿ã‚¹ã‚¯ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹?',
    confirm_import: 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã¨ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãŒä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚ç¶šã‘ã¾ã™ã‹?',
    confirm_clear_all_1: 'ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹? ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚',
    confirm_clear_all_2: 'æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹?',
    import_success: 'ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ!',
    import_error: 'ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ',
    no_tasks_export: 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“',
    no_memos_export: 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“'
  },
  en: {
    app_title: 'Todo & Memo Pro',
    search: 'Search',
    stats: 'Stats',
    settings: 'Settings',
    todo_mode: 'Todo List',
    memo_mode: 'Memos',
    task_management: 'Task Management',
    memo_management: 'Memo Management',
    add_task: 'Add Task',
    add_memo: 'Save Memo',
    task_placeholder: 'What do you need to do?',
    memo_title_placeholder: 'Memo title...',
    memo_content_placeholder: 'Write your memo here...',
    tags_placeholder: 'Tags (comma separated: work, ideas, important)',
    sort_by: 'Sort by:',
    sort_newest: 'Newest',
    sort_oldest: 'Oldest',
    sort_priority: 'Priority',
    sort_duedate: 'Due Date',
    sort_alphabetical: 'Alphabetical',
    sort_longest: 'Longest',
    filter_all: 'All',
    filter_active: 'Active',
    filter_completed: 'Completed',
    filter_high: 'Priority: High',
    filter_medium: 'Priority: Medium',
    filter_low: 'Priority: Low',
    filter_overdue: 'Overdue',
    stat_total: 'Total',
    stat_active: 'Active',
    stat_completed: 'Completed',
    stat_completion_rate: 'Completion Rate',
    export_all_tasks: 'Export All Tasks',
    export_all_memos: 'Export All Memos',
    clear_completed: 'Clear Completed',
    no_tasks: 'No tasks found',
    no_memos: 'No memos yet',
    delete_btn: 'Delete',
    export_btn: 'Export',
    edit_btn: 'Edit',
    duplicate_btn: 'Duplicate',
    priority_high: 'High',
    priority_medium: 'Medium',
    priority_low: 'Low',
    priority_none: 'No Priority',
    untitled: 'Untitled',
    due_today: 'Today',
    due_tomorrow: 'Tomorrow',
    overdue: 'Overdue',
    completed: 'Completed',
    active: 'Active',
    edit_task: 'Edit Task',
    task_content: 'Task content',
    due_date: 'Due Date',
    note: 'Note',
    cancel: 'Cancel',
    save: 'Save',
    stats_title: 'Statistics',
    total_tasks: 'Total Tasks',
    active_tasks: 'Active Tasks',
    completed_tasks: 'Completed Tasks',
    high_priority_tasks: 'High Priority Tasks',
    total_memos: 'Total Memos',
    tags_in_use: 'Tags in Use',
    settings_title: 'Settings',
    import_data: 'Import Data',
    export_data: 'Export All',
    clear_all: 'Clear All',
    search_title: 'Search',
    search_placeholder: 'Search tasks and memos...',
    no_results: 'No results found',
    confirm_delete_task: 'Delete this task?',
    confirm_delete_memo: 'Delete this memo?',
    confirm_clear_completed: 'Clear all completed tasks?',
    confirm_import: 'Importing will overwrite current data. Continue?',
    confirm_clear_all_1: 'Delete all data? This cannot be undone.',
    confirm_clear_all_2: 'Are you sure?',
    import_success: 'Data imported successfully!',
    import_error: 'Failed to load file',
    no_tasks_export: 'No tasks to export',
    no_memos_export: 'No memos to export'
  }
};

// UIæ›´æ–°é–¢æ•°
function updateUILanguage() {
  const t = translations[currentLang];
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼
  document.querySelector('.logo').textContent = `ğŸ“ ${t.app_title}`;
  document.querySelectorAll('.header-btn')[0].textContent = `ğŸ” ${t.search}`;
  document.querySelectorAll('.header-btn')[1].textContent = `ğŸ“Š ${t.stats}`;
  document.querySelectorAll('.header-btn')[2].textContent = `âš™ï¸ ${t.settings}`;
  
  // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
  document.querySelector('[data-mode="todo"]').textContent = `ğŸ“ ${t.todo_mode}`;
  document.querySelector('[data-mode="memo"]').textContent = `ğŸ“„ ${t.memo_mode}`;
  
  // Todoã‚»ã‚¯ã‚·ãƒ§ãƒ³
  document.querySelector('.todo-container h1').textContent = t.task_management;
  document.getElementById('todoInput').placeholder = t.task_placeholder;
  document.getElementById('addTodoBtn').textContent = t.add_task;
  
  // Todoä¸¦ã³æ›¿ãˆ
  const todoSortOptions = document.querySelectorAll('#todoSort option');
  todoSortOptions[0].textContent = t.sort_newest;
  todoSortOptions[1].textContent = t.sort_oldest;
  todoSortOptions[2].textContent = t.sort_priority;
  todoSortOptions[3].textContent = t.sort_duedate;
  todoSortOptions[4].textContent = t.sort_alphabetical;
  
  // Todoãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  const todoFilters = document.querySelectorAll('.filter-tabs .filter-btn');
  todoFilters[0].textContent = t.filter_all;
  todoFilters[1].textContent = t.filter_active;
  todoFilters[2].textContent = t.filter_completed;
  todoFilters[3].textContent = t.filter_high;
  todoFilters[4].textContent = t.filter_medium;
  todoFilters[5].textContent = t.filter_low;
  todoFilters[6].textContent = t.filter_overdue;
  
  // Todoçµ±è¨ˆ
  document.querySelectorAll('.todo-container .stat-label')[0].textContent = t.stat_total;
  document.querySelectorAll('.todo-container .stat-label')[1].textContent = t.stat_active;
  document.querySelectorAll('.todo-container .stat-label')[2].textContent = t.stat_completed;
  document.querySelectorAll('.todo-container .stat-label')[3].textContent = t.stat_completion_rate;
  
  // Todoã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  document.querySelectorAll('.todo-container .export-section button')[0].textContent = `ğŸ“¥ ${t.export_all_tasks}`;
  document.querySelectorAll('.todo-container .export-section button')[1].textContent = `ğŸ—‘ï¸ ${t.clear_completed}`;
  
  // Memoã‚»ã‚¯ã‚·ãƒ§ãƒ³
  document.querySelector('.memo-container h1').textContent = t.memo_management;
  document.getElementById('memoTitle').placeholder = t.memo_title_placeholder;
  document.getElementById('memoContent').placeholder = t.memo_content_placeholder;
  document.getElementById('memoTags').placeholder = t.tags_placeholder;
  document.getElementById('addMemoBtn').textContent = t.add_memo;
  
  // Memoä¸¦ã³æ›¿ãˆ
  const memoSortLabel = document.querySelectorAll('.memo-container .sort-label')[0];
  if (memoSortLabel) memoSortLabel.textContent = t.sort_by;
  
  const memoSortOptions = document.querySelectorAll('#memoSort option');
  memoSortOptions[0].textContent = t.sort_newest;
  memoSortOptions[1].textContent = t.sort_oldest;
  memoSortOptions[2].textContent = t.sort_alphabetical;
  memoSortOptions[3].textContent = t.sort_longest;
  
  // Memoã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  document.querySelectorAll('.memo-container .export-section button')[0].textContent = `ğŸ“¥ ${t.export_all_memos}`;
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«
  document.querySelector('#editTodoModal .modal-title').textContent = `ğŸ“ ${t.edit_task}`;
  document.getElementById('editTodoText').placeholder = t.task_content;
  
  const priorityOptions = document.querySelectorAll('#editTodoPriority option');
  priorityOptions[0].textContent = t.priority_none;
  priorityOptions[1].textContent = t.priority_high;
  priorityOptions[2].textContent = t.priority_medium;
  priorityOptions[3].textContent = t.priority_low;
  
  document.getElementById('editTodoTags').placeholder = t.tags_placeholder;
  document.getElementById('editTodoNote').placeholder = t.note;
  
  document.querySelectorAll('#editTodoModal .modal-btn')[0].textContent = t.cancel;
  document.querySelectorAll('#editTodoModal .modal-btn')[1].textContent = t.save;
  
  // æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ«
  document.querySelector('#searchModal .modal-title').textContent = `ğŸ” ${t.search_title}`;
  document.getElementById('searchInput').placeholder = t.search_placeholder;
  
  // çµ±è¨ˆãƒ¢ãƒ¼ãƒ€ãƒ«
  document.querySelector('#statsModal .modal-title').textContent = `ğŸ“Š ${t.stats_title}`;
  
  // è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
  document.querySelector('#settingsModal .modal-title').textContent = `âš™ï¸ ${t.settings_title}`;
  const settingsButtons = document.querySelectorAll('#settingsModal .modal-btn');
  settingsButtons[0].textContent = `ğŸ“¤ ${t.import_data}`;
  settingsButtons[1].textContent = `ğŸ“¥ ${t.export_data}`;
  settingsButtons[2].textContent = `ğŸ—‘ï¸ ${t.clear_all}`;
}

// LocalStorageç®¡ç†
function saveTodos() {
  try {
    localStorage.setItem('todos', JSON.stringify(todos));
  } catch (e) {
    console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
  }
}

function loadTodos() {
  try {
    const stored = localStorage.getItem('todos');
    if (stored) {
      todos = JSON.parse(stored);
    }
  } catch (e) {
    console.error('èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
  }
}

function saveMemos() {
  try {
    localStorage.setItem('memos', JSON.stringify(memos));
  } catch (e) {
    console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
  }
}

function loadMemos() {
  try {
    const stored = localStorage.getItem('memos');
    if (stored) {
      memos = JSON.parse(stored);
      updateMemoTags();
    }
  } catch (e) {
    console.error('èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
  }
}

// Todoæ©Ÿèƒ½
function addTodo() {
  const text = document.getElementById('todoInput').value.trim();
  if (!text) return;

  todos.unshift({
    id: Date.now(),
    text: text,
    completed: false,
    date: new Date().toLocaleString(currentLang === 'ja' ? 'ja-JP' : 'en-US'),
    priority: '',
    tags: [],
    dueDate: null,
    note: ''
  });

  document.getElementById('todoInput').value = '';
  saveTodos();
  renderTodos();
}

function toggleTodo(id) {
  const todo = todos.find(t => t.id === id);
  if (todo) {
    todo.completed = !todo.completed;
    if (todo.completed) {
      todo.completedDate = new Date().toLocaleString(currentLang === 'ja' ? 'ja-JP' : 'en-US');
    } else {
      delete todo.completedDate;
    }
    saveTodos();
    renderTodos();
  }
}

function deleteTodo(id) {
  const t = translations[currentLang];
  if (confirm(t.confirm_delete_task)) {
    todos = todos.filter(t => t.id !== id);
    saveTodos();
    renderTodos();
  }
}

function duplicateTodo(id) {
  const todo = todos.find(t => t.id === id);
  if (!todo) return;

  const t = translations[currentLang];
  const copyLabel = currentLang === 'ja' ? ' (ã‚³ãƒ”ãƒ¼)' : ' (Copy)';

  todos.unshift({
    ...todo,
    id: Date.now(),
    completed: false,
    date: new Date().toLocaleString(currentLang === 'ja' ? 'ja-JP' : 'en-US'),
    text: todo.text + copyLabel
  });

  saveTodos();
  renderTodos();
}

function exportTodo(id) {
  const todo = todos.find(t => t.id === id);
  if (!todo) return;
  
  const t = translations[currentLang];

  let content = `${currentLang === 'ja' ? 'ã‚¿ã‚¹ã‚¯' : 'Task'}: ${todo.text}\n${'='.repeat(50)}\n\n`;
  content += `${currentLang === 'ja' ? 'çŠ¶æ…‹' : 'Status'}: ${todo.completed ? 'âœ“ ' + t.completed : 'â˜ ' + t.active}\n`;
  
  if (todo.priority) {
    content += `${currentLang === 'ja' ? 'å„ªå…ˆåº¦' : 'Priority'}: ${t['priority_' + todo.priority]}\n`;
  }
  
  if (todo.dueDate) {
    content += `${currentLang === 'ja' ? 'æœŸé™' : 'Due Date'}: ${new Date(todo.dueDate).toLocaleDateString(currentLang === 'ja' ? 'ja-JP' : 'en-US')}\n`;
  }
  
  if (todo.tags && todo.tags.length > 0) {
    content += `${currentLang === 'ja' ? 'ã‚¿ã‚°' : 'Tags'}: ${todo.tags.join(', ')}\n`;
  }
  
  if (todo.note) {
    content += `\n${currentLang === 'ja' ? 'ãƒ¡ãƒ¢' : 'Note'}:\n${todo.note}\n`;
  }
  
  content += `\n${currentLang === 'ja' ? 'ä½œæˆæ—¥æ™‚' : 'Created'}: ${todo.date || (currentLang === 'ja' ? 'ä¸æ˜' : 'Unknown')}`;
  
  if (todo.completedDate) {
    content += `\n${currentLang === 'ja' ? 'å®Œäº†æ—¥æ™‚' : 'Completed'}: ${todo.completedDate}`;
  }

  downloadTextFile(
    todo.text.substring(0, 30).replace(/[^a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g, '_') + '.txt',
    content
  );
}

function exportAllTodos() {
  const t = translations[currentLang];
  
  if (todos.length === 0) {
    alert(t.no_tasks_export);
    return;
  }

  const header = currentLang === 'ja' ? 'ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ' : 'Task List';
  let content = header + '\n' + '='.repeat(50) + '\n\n';
  
  const active = todos.filter(t => !t.completed);
  const completed = todos.filter(t => t.completed);

  if (active.length > 0) {
    content += `ã€${currentLang === 'ja' ? 'æœªå®Œäº†' : 'Active'}ã€‘\n`;
    active.forEach((todo, index) => {
      content += `${index + 1}. â˜ ${todo.text}`;
      if (todo.priority) content += ` [${t['priority_' + todo.priority]}]`;
      if (todo.dueDate) content += ` (${currentLang === 'ja' ? 'æœŸé™' : 'Due'}: ${new Date(todo.dueDate).toLocaleDateString()})`;
      if (todo.tags && todo.tags.length > 0) content += ` #${todo.tags.join(' #')}`;
      content += '\n';
    });
    content += '\n';
  }

  if (completed.length > 0) {
    content += `ã€${currentLang === 'ja' ? 'å®Œäº†æ¸ˆã¿' : 'Completed'}ã€‘\n`;
    completed.forEach((todo, index) => {
      content += `${index + 1}. â˜‘ ${todo.text}`;
      if (todo.priority) content += ` [${t['priority_' + todo.priority]}]`;
      if (todo.tags && todo.tags.length > 0) content += ` #${todo.tags.join(' #')}`;
      content += '\n';
    });
  }

  content += '\n' + '='.repeat(50) + '\n';
  const summary = currentLang === 'ja' 
    ? `åˆè¨ˆ: ${todos.length} | æœªå®Œäº†: ${active.length} | å®Œäº†æ¸ˆã¿: ${completed.length}\n`
    : `Total: ${todos.length} | Active: ${active.length} | Completed: ${completed.length}\n`;
  content += summary;

  downloadTextFile(`todos_${new Date().toISOString().split('T')[0]}.txt`, content);
}

function clearCompleted() {
  const t = translations[currentLang];
  if (confirm(t.confirm_clear_completed)) {
    todos = todos.filter(t => !t.completed);
    saveTodos();
    renderTodos();
  }
}

function openEditTodoModal(id) {
  editingTodoId = id;
  const todo = todos.find(t => t.id === id);
  if (!todo) return;

  document.getElementById('editTodoText').value = todo.text;
  document.getElementById('editTodoPriority').value = todo.priority || '';
  document.getElementById('editTodoDueDate').value = todo.dueDate || '';
  document.getElementById('editTodoTags').value = todo.tags ? todo.tags.join(', ') : '';
  document.getElementById('editTodoNote').value = todo.note || '';
  document.getElementById('editTodoModal').classList.add('active');
}

function closeEditTodoModal() {
  document.getElementById('editTodoModal').classList.remove('active');
  editingTodoId = null;
}

function saveEditedTodo() {
  if (!editingTodoId) return;

  const todo = todos.find(t => t.id === editingTodoId);
  if (!todo) return;

  todo.text = document.getElementById('editTodoText').value.trim();
  todo.priority = document.getElementById('editTodoPriority').value;
  todo.dueDate = document.getElementById('editTodoDueDate').value;
  todo.note = document.getElementById('editTodoNote').value.trim();
  
  const tagInput = document.getElementById('editTodoTags').value.trim();
  todo.tags = tagInput ? tagInput.split(',').map(t => t.trim()).filter(t => t) : [];

  saveTodos();
  renderTodos();
  closeEditTodoModal();
}

function getDueDateStatus(dueDate) {
  if (!dueDate) return null;
  
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  const due = new Date(dueDate);
  due.setHours(0, 0, 0, 0);
  
  const diffTime = due - today;
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  
  if (diffDays < 0) return { text: translations[currentLang].overdue, class: 'overdue' };
  if (diffDays === 0) return { text: translations[currentLang].due_today, class: 'due-today' };
  if (diffDays === 1) return { text: translations[currentLang].due_tomorrow, class: 'due-tomorrow' };
  return { text: new Date(dueDate).toLocaleDateString(currentLang === 'ja' ? 'ja-JP' : 'en-US'), class: '' };
}

function sortTodos(todosToSort) {
  const sorted = [...todosToSort];
  
  switch (currentTodoSort) {
    case 'oldest':
      return sorted.reverse();
    case 'priority':
      const priorityOrder = { 'high': 0, 'medium': 1, 'low': 2, '': 3 };
      return sorted.sort((a, b) => priorityOrder[a.priority || ''] - priorityOrder[b.priority || '']);
    case 'duedate':
      return sorted.sort((a, b) => {
        if (!a.dueDate && !b.dueDate) return 0;
        if (!a.dueDate) return 1;
        if (!b.dueDate) return -1;
        return new Date(a.dueDate) - new Date(b.dueDate);
      });
    case 'alphabetical':
      return sorted.sort((a, b) => a.text.localeCompare(b.text));
    default: // newest
      return sorted;
  }
}

function renderTodos() {
  let filtered = todos.filter(todo => {
    if (currentFilter === 'active') return !todo.completed;
    if (currentFilter === 'completed') return todo.completed;
    if (currentFilter === 'high') return todo.priority === 'high';
    if (currentFilter === 'medium') return todo.priority === 'medium';
    if (currentFilter === 'low') return todo.priority === 'low';
    if (currentFilter === 'overdue') {
      if (!todo.dueDate || todo.completed) return false;
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const due = new Date(todo.dueDate);
      due.setHours(0, 0, 0, 0);
      return due < today;
    }
    return true;
  });

  filtered = sortTodos(filtered);

  const list = document.getElementById('todoList');
  
  if (filtered.length === 0) {
    list.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <div class="empty-state-text">${translations[currentLang].no_tasks}</div>
      </div>
    `;
  } else {
    list.innerHTML = filtered.map(todo => {
      const dueStatus = getDueDateStatus(todo.dueDate);
      
      return `
        <li class="todo-item ${todo.completed ? 'completed' : ''}" data-id="${todo.id}">
          <div class="todo-main-row">
            <div class="checkbox ${todo.completed ? 'checked' : ''}" onclick="toggleTodo(${todo.id})"></div>
            <div class="todo-text">${todo.text}</div>
            <div class="todo-actions">
              ${todo.priority ? `<span class="priority-badge priority-${todo.priority}">${translations[currentLang]['priority_' + todo.priority]}</span>` : ''}
              ${dueStatus ? `<span class="due-date-badge ${dueStatus.class}">${dueStatus.text}</span>` : ''}
              <button class="action-btn duplicate" onclick="duplicateTodo(${todo.id})" title="è¤‡è£½">ğŸ“‹</button>
              <button class="action-btn edit" onclick="openEditTodoModal(${todo.id})" title="ç·¨é›†">âœï¸</button>
              <button class="action-btn export" onclick="exportTodo(${todo.id})" title="ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ">ğŸ’¾</button>
              <button class="action-btn" onclick="deleteTodo(${todo.id})" title="å‰Šé™¤">ğŸ—‘ï¸</button>
            </div>
          </div>
          ${todo.tags && todo.tags.length > 0 ? `
            <div class="todo-meta">
              ${todo.tags.map(tag => `<span class="todo-tag">#${tag}</span>`).join('')}
            </div>
          ` : ''}
          ${todo.note ? `
            <div class="todo-meta">
              <span style="color: #d1d5db;">${todo.note}</span>
            </div>
          ` : ''}
        </li>
      `;
    }).join('');
  }

  updateStats();
  
  // Sortable.jsã§ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚’æœ‰åŠ¹åŒ–
  if (typeof Sortable !== 'undefined' && !todoSortable) {
    const list = document.getElementById('todoList');
    todoSortable = Sortable.create(list, {
      animation: 150,
      ghostClass: 'sortable-ghost',
      onEnd: function(evt) {
        // ãƒ‰ãƒ©ãƒƒã‚°å¾Œã®é †åºã‚’ä¿å­˜
        const items = Array.from(list.children);
        const newOrder = items.map(item => parseInt(item.dataset.id));
        
        // todosã®é †åºã‚’æ›´æ–°
        const reordered = [];
        newOrder.forEach(id => {
          const todo = todos.find(t => t.id === id);
          if (todo) reordered.push(todo);
        });
        todos = reordered;
        saveTodos();
      }
    });
  }
}

function updateStats() {
  const total = todos.length;
  const active = todos.filter(t => !t.completed).length;
  const completed = todos.filter(t => t.completed).length;
  const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

  document.getElementById('totalTasks').textContent = total;
  document.getElementById('activeTasks').textContent = active;
  document.getElementById('completedTasks').textContent = completed;
  document.getElementById('completionRate').textContent = rate + '%';
}

// Memoæ©Ÿèƒ½
function addMemo() {
  const title = document.getElementById('memoTitle').value.trim();
  const content = document.getElementById('memoContent').value.trim();
  
  if (!title && !content) return;

  const tagInput = document.getElementById('memoTags').value.trim();
  const tags = tagInput ? tagInput.split(',').map(t => t.trim()).filter(t => t) : [];

  memos.unshift({
    id: Date.now(),
    title: title || translations[currentLang].untitled,
    content: content,
    date: new Date().toLocaleString(currentLang === 'ja' ? 'ja-JP' : 'en-US'),
    tags: tags
  });

  document.getElementById('memoTitle').value = '';
  document.getElementById('memoContent').value = '';
  document.getElementById('memoTags').value = '';

  saveMemos();
  updateMemoTags();
  renderMemos();
}

function deleteMemo(id) {
  const t = translations[currentLang];
  if (confirm(t.confirm_delete_memo)) {
    memos = memos.filter(m => m.id !== id);
    saveMemos();
    updateMemoTags();
    renderMemos();
  }
}

function duplicateMemo(id) {
  const memo = memos.find(m => m.id === id);
  if (!memo) return;

  const copyLabel = currentLang === 'ja' ? ' (ã‚³ãƒ”ãƒ¼)' : ' (Copy)';

  memos.unshift({
    ...memo,
    id: Date.now(),
    title: memo.title + copyLabel,
    date: new Date().toLocaleString(currentLang === 'ja' ? 'ja-JP' : 'en-US')
  });

  saveMemos();
  updateMemoTags();
  renderMemos();
}

function editMemo(id) {
  const memo = memos.find(m => m.id === id);
  if (!memo) return;

  document.getElementById('memoTitle').value = memo.title;
  document.getElementById('memoContent').value = memo.content;
  document.getElementById('memoTags').value = memo.tags ? memo.tags.join(', ') : '';

  deleteMemo(id);
  window.scrollTo({ top: 0, behavior: 'smooth' });
  document.getElementById('memoTitle').focus();
}

function exportMemo(id) {
  const memo = memos.find(m => m.id === id);
  if (!memo) return;

  let content = memo.title + '\n' + '='.repeat(memo.title.length) + '\n\n';
  content += memo.content + '\n\n';
  
  if (memo.tags && memo.tags.length > 0) {
    const tagLabel = currentLang === 'ja' ? 'ã‚¿ã‚°' : 'Tags';
    content += `${tagLabel}: ${memo.tags.join(', ')}\n\n`;
  }
  
  const createdLabel = currentLang === 'ja' ? 'ä½œæˆæ—¥æ™‚' : 'Created';
  content += '---\n' + createdLabel + ': ' + memo.date;

  downloadTextFile(
    memo.title.replace(/[^a-zA-Z0-9_\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g, '_') + '.txt',
    content
  );
}

function exportAllMemos() {
  const t = translations[currentLang];
  
  if (memos.length === 0) {
    alert(t.no_memos_export);
    return;
  }

  const header = currentLang === 'ja' ? 'ãƒ¡ãƒ¢ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³' : 'Memo Collection';
  let content = header + '\n' + '='.repeat(50) + '\n\n';

  memos.forEach((memo, index) => {
    content += `${index + 1}. ${memo.title}\n`;
    content += '-'.repeat(memo.title.length + 3) + '\n';
    content += memo.content + '\n';
    
    if (memo.tags && memo.tags.length > 0) {
      const tagLabel = currentLang === 'ja' ? 'ã‚¿ã‚°' : 'Tags';
      content += `${tagLabel}: ${memo.tags.join(', ')}\n`;
    }
    
    const createdLabel = currentLang === 'ja' ? 'ä½œæˆæ—¥æ™‚' : 'Created';
    content += `${createdLabel}: ${memo.date}\n\n`;
    content += '='.repeat(50) + '\n\n';
  });

  downloadTextFile(`all_memos_${new Date().toISOString().split('T')[0]}.txt`, content);
}

function updateMemoTags() {
  const t = translations[currentLang];
  
  allMemoTags.clear();
  memos.forEach(memo => {
    if (memo.tags && memo.tags.length > 0) {
      memo.tags.forEach(tag => allMemoTags.add(tag));
    }
  });

  const filtersDiv = document.getElementById('memoFilters');
  const allButton = `<button class="filter-btn ${currentMemoFilter === 'all' ? 'active' : ''}" onclick="filterMemosByTag('all')">${t.filter_all}</button>`;
  const tagButtons = Array.from(allMemoTags).map(tag => 
    `<button class="filter-btn ${currentMemoFilter === tag ? 'active' : ''}" onclick="filterMemosByTag('${tag}')">#${tag}</button>`
  ).join('');
  
  filtersDiv.innerHTML = allButton + tagButtons;
}

function filterMemosByTag(tag) {
  currentMemoFilter = tag;
  updateMemoTags();
  renderMemos();
}

function sortMemos(memosToSort) {
  const sorted = [...memosToSort];
  
  switch (currentMemoSort) {
    case 'oldest':
      return sorted.reverse();
    case 'alphabetical':
      return sorted.sort((a, b) => a.title.localeCompare(b.title));
    case 'longest':
      return sorted.sort((a, b) => b.content.length - a.content.length);
    default: // newest
      return sorted;
  }
}

function renderMemos() {
  let filtered = memos.filter(memo => {
    if (currentMemoFilter === 'all') return true;
    return memo.tags && memo.tags.includes(currentMemoFilter);
  });

  filtered = sortMemos(filtered);

  const list = document.getElementById('memoList');
  
  if (filtered.length === 0) {
    list.innerHTML = `
      <div class="empty-state" style="grid-column: 1 / -1;">
        <div class="empty-state-icon">ğŸ“</div>
        <div class="empty-state-text">${translations[currentLang].no_memos}</div>
      </div>
    `;
  } else {
    list.innerHTML = filtered.map(memo => `
      <div class="memo-item">
        <div class="memo-header">
          <div class="memo-title">${memo.title}</div>
          <div class="memo-actions">
            <button class="action-btn duplicate" onclick="duplicateMemo(${memo.id})" title="è¤‡è£½">ğŸ“‹</button>
            <button class="action-btn edit" onclick="editMemo(${memo.id})" title="ç·¨é›†">âœï¸</button>
            <button class="action-btn export" onclick="exportMemo(${memo.id})" title="ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ">ğŸ’¾</button>
            <button class="action-btn" onclick="deleteMemo(${memo.id})" title="å‰Šé™¤">ğŸ—‘ï¸</button>
          </div>
        </div>
        <div class="memo-content-preview">${typeof marked !== 'undefined' ? marked.parse(memo.content.substring(0, 200) + (memo.content.length > 200 ? '...' : '')) : memo.content.substring(0, 200) + (memo.content.length > 200 ? '...' : '')}</div>
        ${memo.tags && memo.tags.length > 0 ? `
          <div class="memo-tags-display">
            ${memo.tags.map(tag => `<span class="memo-tag-item">#${tag}</span>`).join('')}
          </div>
        ` : ''}
        <div class="memo-date">${memo.date}</div>
      </div>
    `).join('');
  }
}

// ãƒ„ãƒ¼ãƒ«ãƒãƒ¼æ©Ÿèƒ½
function insertText(text) {
  const textarea = document.getElementById('memoContent');
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const selectedText = textarea.value.substring(start, end);
  const content = textarea.value;

  let insertedText = '';
  let cursorOffset = 0;

  // å¤ªå­—ãƒ»æ–œä½“ãƒ»æ‰“ã¡æ¶ˆã—ç·šã®å‡¦ç†ï¼ˆé¸æŠç¯„å›²ãŒã‚ã‚‹å ´åˆã¯å›²ã‚€ï¼‰
  if (text === '**å¤ªå­—**' || text === '*æ–œä½“*' || text === '~~æ‰“ã¡æ¶ˆã—ç·š~~') {
    if (selectedText) {
      let marker;
      if (text === '**å¤ªå­—**') marker = '**';
      else if (text === '*æ–œä½“*') marker = '*';
      else marker = '~~';
      
      insertedText = marker + selectedText + marker;
      cursorOffset = insertedText.length;
    } else {
      insertedText = text;
      if (text === '**å¤ªå­—**') cursorOffset = 2;
      else if (text === '*æ–œä½“*') cursorOffset = 1;
      else cursorOffset = 2; // ~~ã®ä¸­
    }
  }
  // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®å‡¦ç†
  else if (text.includes('```')) {
    if (selectedText) {
      insertedText = '```\n' + selectedText + '\n```';
      cursorOffset = insertedText.length;
    } else {
      insertedText = '```\n\n```';
      cursorOffset = 4; // æ”¹è¡Œã®å¾Œã«ã‚«ãƒ¼ã‚½ãƒ«
    }
  }
  // ãã®ä»–ã®å‡¦ç†ï¼ˆè¦‹å‡ºã—ã€ãƒªã‚¹ãƒˆã€å¼•ç”¨ãªã©ï¼‰
  else {
    insertedText = text;
    cursorOffset = text.length;
  }

  textarea.value = content.substring(0, start) + insertedText + content.substring(end);
  textarea.focus();
  textarea.selectionStart = textarea.selectionEnd = start + cursorOffset;
}

// ãƒªãƒ³ã‚¯æŒ¿å…¥
function insertLink() {
  const textarea = document.getElementById('memoContent');
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const selectedText = textarea.value.substring(start, end);
  const content = textarea.value;

  let insertedText;
  let cursorOffset;

  if (selectedText) {
    insertedText = `[${selectedText}](URL)`;
    cursorOffset = insertedText.length - 4; // "URL"ã®å‰ã«ã‚«ãƒ¼ã‚½ãƒ«
  } else {
    insertedText = '[ãƒªãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆ](URL)';
    cursorOffset = 1; // "[" ã®å¾Œã«ã‚«ãƒ¼ã‚½ãƒ«
  }

  textarea.value = content.substring(0, start) + insertedText + content.substring(end);
  textarea.focus();
  textarea.selectionStart = start + cursorOffset;
  textarea.selectionEnd = start + cursorOffset + (selectedText ? 3 : 11); // "URL" ã¾ãŸã¯ "ãƒªãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆ" ã‚’é¸æŠ
}

// ç”»åƒæŒ¿å…¥
function insertImage() {
  const textarea = document.getElementById('memoContent');
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const content = textarea.value;

  const insertedText = '![ç”»åƒã®èª¬æ˜](ç”»åƒã®URL)';
  
  textarea.value = content.substring(0, start) + insertedText + content.substring(end);
  textarea.focus();
  textarea.selectionStart = start + 2; // "![" ã®å¾Œ
  textarea.selectionEnd = start + 8; // "ç”»åƒã®èª¬æ˜" ã‚’é¸æŠ
}

// ãƒ†ãƒ¼ãƒ–ãƒ«æŒ¿å…¥
function insertTable() {
  const textarea = document.getElementById('memoContent');
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const content = textarea.value;

  const tableText = `| åˆ—1 | åˆ—2 | åˆ—3 |
| --- | --- | --- |
| ãƒ‡ãƒ¼ã‚¿1 | ãƒ‡ãƒ¼ã‚¿2 | ãƒ‡ãƒ¼ã‚¿3 |
| ãƒ‡ãƒ¼ã‚¿4 | ãƒ‡ãƒ¼ã‚¿5 | ãƒ‡ãƒ¼ã‚¿6 |`;
  
  textarea.value = content.substring(0, start) + tableText + content.substring(end);
  textarea.focus();
  textarea.selectionStart = textarea.selectionEnd = start + tableText.length;
}

// æ°´å¹³ç·šæŒ¿å…¥
function insertHorizontalRule() {
  const textarea = document.getElementById('memoContent');
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const content = textarea.value;

  const hrText = '\n---\n';
  
  textarea.value = content.substring(0, start) + hrText + content.substring(end);
  textarea.focus();
  textarea.selectionStart = textarea.selectionEnd = start + hrText.length;
}

// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
function downloadTextFile(filename, content) {
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(link.href);
}

// æ¤œç´¢æ©Ÿèƒ½
function openSearch() {
  document.getElementById('searchModal').classList.add('active');
  document.getElementById('searchInput').focus();
}

function closeSearch() {
  document.getElementById('searchModal').classList.remove('active');
  document.getElementById('searchInput').value = '';
  document.getElementById('searchResults').innerHTML = '';
}

function jumpTo(type, id) {
  closeSearch();
  
  const modeButtons = document.querySelectorAll('.mode-btn');
  const todoContainer = document.querySelector('.todo-container');
  const memoContainer = document.querySelector('.memo-container');

  modeButtons.forEach(btn => btn.classList.remove('active'));

  if (type === 'todo') {
    document.querySelector('[data-mode="todo"]').classList.add('active');
    todoContainer.classList.add('active');
    memoContainer.classList.remove('active');

    setTimeout(() => {
      const element = document.querySelector(`[data-id="${id}"]`);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        element.style.boxShadow = '0 0 30px rgba(103, 6, 118, 0.8)';
        setTimeout(() => element.style.boxShadow = '', 2000);
      }
    }, 100);
  } else {
    document.querySelector('[data-mode="memo"]').classList.add('active');
    todoContainer.classList.remove('active');
    memoContainer.classList.add('active');
  }
}

// çµ±è¨ˆãƒ¢ãƒ¼ãƒ€ãƒ«
function showStats() {
  const modal = document.getElementById('statsModal');
  const content = document.getElementById('statsContent');
  const t = translations[currentLang];
  
  const totalTodos = todos.length;
  const activeTodos = todos.filter(t => !t.completed).length;
  const completedTodos = todos.filter(t => t.completed).length;
  const highPriority = todos.filter(t => t.priority === 'high').length;
  const mediumPriority = todos.filter(t => t.priority === 'medium').length;
  const lowPriority = todos.filter(t => t.priority === 'low').length;
  const totalMemos = memos.length;
  const totalTags = allMemoTags.size;
  
  content.innerHTML = `
    <div class="stats">
      <div class="stat-item">
        <div class="stat-value">${totalTodos}</div>
        <div class="stat-label">${t.total_tasks}</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">${activeTodos}</div>
        <div class="stat-label">${t.active_tasks}</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">${completedTodos}</div>
        <div class="stat-label">${t.completed_tasks}</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">${highPriority}</div>
        <div class="stat-label">${t.high_priority_tasks}</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">${totalMemos}</div>
        <div class="stat-label">${t.total_memos}</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">${totalTags}</div>
        <div class="stat-label">${t.tags_in_use}</div>
      </div>
    </div>
    
    <div class="chart-container" style="margin-top: 2rem;">
      <canvas id="statsChart"></canvas>
    </div>
    
    <div class="chart-container">
      <canvas id="priorityChart"></canvas>
    </div>
  `;
  
  modal.classList.add('active');
  
  // Chart.jsã§ã‚°ãƒ©ãƒ•ã‚’æç”»
  setTimeout(() => {
    if (typeof Chart !== 'undefined') {
      // ã‚¿ã‚¹ã‚¯å®Œäº†çŠ¶æ³ã®ãƒ‰ãƒ¼ãƒŠãƒ„ãƒãƒ£ãƒ¼ãƒˆ
      const ctx1 = document.getElementById('statsChart');
      if (ctx1) {
        new Chart(ctx1, {
          type: 'doughnut',
          data: {
            labels: [t.active_tasks || 'æœªå®Œäº†', t.completed_tasks || 'å®Œäº†æ¸ˆã¿'],
            datasets: [{
              data: [activeTodos, completedTodos],
              backgroundColor: ['#a855f7', '#10b981'],
              borderColor: ['#670676', '#059669'],
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                labels: { color: '#fff' },
                position: 'bottom'
              },
              title: {
                display: true,
                text: currentLang === 'ja' ? 'ã‚¿ã‚¹ã‚¯å®Œäº†çŠ¶æ³' : 'Task Completion Status',
                color: '#a855f7',
                font: { size: 16, weight: 'bold' }
              }
            }
          }
        });
      }
      
      // å„ªå…ˆåº¦åˆ¥ã®æ£’ã‚°ãƒ©ãƒ•
      const ctx2 = document.getElementById('priorityChart');
      if (ctx2) {
        new Chart(ctx2, {
          type: 'bar',
          data: {
            labels: [t.priority_high || 'é«˜', t.priority_medium || 'ä¸­', t.priority_low || 'ä½'],
            datasets: [{
              label: currentLang === 'ja' ? 'ã‚¿ã‚¹ã‚¯æ•°' : 'Tasks',
              data: [highPriority, mediumPriority, lowPriority],
              backgroundColor: ['#ef4444', '#fbbf24', '#10b981'],
              borderColor: ['#dc2626', '#f59e0b', '#059669'],
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                labels: { color: '#fff' }
              },
              title: {
                display: true,
                text: currentLang === 'ja' ? 'å„ªå…ˆåº¦åˆ¥ã‚¿ã‚¹ã‚¯æ•°' : 'Tasks by Priority',
                color: '#a855f7',
                font: { size: 16, weight: 'bold' }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: { color: '#fff' },
                grid: { color: 'rgba(103, 6, 118, 0.2)' }
              },
              x: {
                ticks: { color: '#fff' },
                grid: { color: 'rgba(103, 6, 118, 0.2)' }
              }
            }
          }
        });
      }
    }
  }, 100);
}

function closeStats() {
  document.getElementById('statsModal').classList.remove('active');
}

// è¨­å®šæ©Ÿèƒ½
function openSettings() {
  document.getElementById('settingsModal').classList.add('active');
}

function closeSettings() {
  document.getElementById('settingsModal').classList.remove('active');
}

// ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«
function showKeyboardShortcuts() {
  document.getElementById('shortcutsModal').classList.add('active');
}

function closeKeyboardShortcuts() {
  document.getElementById('shortcutsModal').classList.remove('active');
}

function exportAllData() {
  const data = {
    todos: todos,
    memos: memos,
    exportDate: new Date().toISOString()
  };
  
  const json = JSON.stringify(data, null, 2);
  downloadTextFile(`todo-memo-backup-${new Date().toISOString().split('T')[0]}.json`, json);
}

function importData() {
  const t = translations[currentLang];
  
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const data = JSON.parse(event.target.result);
        
        if (confirm(t.confirm_import)) {
          if (data.todos) todos = data.todos;
          if (data.memos) memos = data.memos;
          
          saveTodos();
          saveMemos();
          updateMemoTags();
          renderTodos();
          renderMemos();
          
          alert(t.import_success);
          closeSettings();
        }
      } catch (error) {
        alert(t.import_error);
      }
    };
    
    reader.readAsText(file);
  };
  
  input.click();
}

function clearAllData() {
  const t = translations[currentLang];
  
  if (confirm(t.confirm_clear_all_1)) {
    if (confirm(t.confirm_clear_all_2)) {
      todos = [];
      memos = [];
      saveTodos();
      saveMemos();
      updateMemoTags();
      renderTodos();
      renderMemos();
      closeSettings();
    }
  }
}

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
document.getElementById('searchInput').addEventListener('input', function(e) {
  const query = e.target.value.toLowerCase().trim();
  const resultsDiv = document.getElementById('searchResults');
  const t = translations[currentLang];

  if (!query) {
    resultsDiv.innerHTML = '';
    return;
  }

  const results = [];

  todos.forEach(todo => {
    if (todo.text.toLowerCase().includes(query) ||
        (todo.tags && todo.tags.some(tag => tag.toLowerCase().includes(query))) ||
        (todo.note && todo.note.toLowerCase().includes(query))) {
      results.push({
        type: 'todo',
        id: todo.id,
        title: todo.text,
        preview: todo.completed ? 'âœ“ ' + t.completed : t.active
      });
    }
  });

  memos.forEach(memo => {
    if (memo.title.toLowerCase().includes(query) ||
        memo.content.toLowerCase().includes(query) ||
        (memo.tags && memo.tags.some(tag => tag.toLowerCase().includes(query)))) {
      results.push({
        type: 'memo',
        id: memo.id,
        title: memo.title,
        preview: memo.content.substring(0, 100) + '...'
      });
    }
  });

  if (results.length === 0) {
    resultsDiv.innerHTML = `<p style="color: #9ca3af; text-align: center;">${t.no_results}</p>`;
    return;
  }

  resultsDiv.innerHTML = results.map(result => `
    <div class="search-result-item" onclick="jumpTo('${result.type}', ${result.id})">
      <div class="search-result-title">${result.type === 'todo' ? 'ğŸ“' : 'ğŸ“„'} ${result.title}</div>
      <div class="search-result-preview">${result.preview}</div>
    </div>
  `).join('');
});

document.getElementById('addTodoBtn').addEventListener('click', addTodo);
document.getElementById('todoInput').addEventListener('keypress', e => {
  if (e.key === 'Enter') addTodo();
});

document.querySelectorAll('.filter-tabs .filter-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.filter-tabs .filter-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    currentFilter = this.dataset.filter;
    renderTodos();
  });
});

document.getElementById('todoSort').addEventListener('change', function() {
  currentTodoSort = this.value;
  renderTodos();
});

document.getElementById('addMemoBtn').addEventListener('click', addMemo);

document.getElementById('memoTitle').addEventListener('keypress', e => {
  if (e.key === 'Enter') {
    e.preventDefault();
    document.getElementById('memoContent').focus();
  }
});

document.getElementById('memoContent').addEventListener('keypress', e => {
  if (e.key === 'Enter' && e.ctrlKey) {
    addMemo();
  }
});

document.getElementById('memoSort').addEventListener('change', function() {
  currentMemoSort = this.value;
  renderMemos();
});

document.querySelectorAll('.mode-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');

    const mode = this.dataset.mode;
    if (mode === 'todo') {
      document.querySelector('.todo-container').classList.add('active');
      document.querySelector('.memo-container').classList.remove('active');
    } else {
      document.querySelector('.todo-container').classList.remove('active');
      document.querySelector('.memo-container').classList.add('active');
    }
  });
});

document.getElementById('langSwitcher').addEventListener('click', () => {
  currentLang = currentLang === 'ja' ? 'en' : 'ja';
  document.getElementById('langSwitcher').textContent = currentLang === 'ja' ? 'EN' : 'JA';
  updateUILanguage();
  renderTodos();
  renderMemos();
});

document.addEventListener('keydown', e => {
  // ãƒ¡ãƒ¢ã‚¨ãƒªã‚¢ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒã‚ã‚‹æ™‚ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
  if (document.activeElement.id === 'memoContent') {
    // Ctrl/Cmd + B ã§å¤ªå­—
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
      e.preventDefault();
      insertText('**å¤ªå­—**');
      return;
    }
    // Ctrl/Cmd + I ã§æ–œä½“
    if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
      e.preventDefault();
      insertText('*æ–œä½“*');
      return;
    }
    // Ctrl/Cmd + K ã§ãƒªãƒ³ã‚¯ï¼ˆãƒ¡ãƒ¢ã‚¨ãƒªã‚¢å†…ï¼‰
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      insertLink();
      return;
    }
    // Ctrl/Cmd + Shift + K ã§ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯
    if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'K') {
      e.preventDefault();
      insertText('```\n\n```');
      return;
    }
  }
  
  // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
  // Ctrl/Cmd + K ã§æ¤œç´¢ï¼ˆãƒ¡ãƒ¢ã‚¨ãƒªã‚¢å¤–ï¼‰
  if ((e.ctrlKey || e.metaKey) && e.key === 'k' && document.activeElement.id !== 'memoContent') {
    e.preventDefault();
    openSearch();
    return;
  }
  
  if (e.key === 'Escape') {
    closeSearch();
    closeEditTodoModal();
    closeStats();
    closeSettings();
    closeKeyboardShortcuts();
  }
});

// åˆæœŸåŒ–
loadTodos();
renderTodos();
loadMemos();
renderMemos();
updateUILanguage();
</script>
</body>
</html>